<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DoV Tactical Manager v3.0 (Data Edition)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #0f172a; color: #f1f5f9; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        .card { background: #1e293b; border: 1px solid #334155; border-radius: 0.5rem; padding: 1rem; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // ==========================================================================================
        //  ZONE DE DONN√âES (C'EST ICI QUE VOUS MODIFIEZ LES STATS)
        // ==========================================================================================

        const MARKET = { WAX: 1, DOVX: 0.005285, DOVF: 0.00045, DOVR: 0.00045, DOVS: 0.00045, DOVH: 0.00045 };

        // 1. D√âFINITION DES COMBATTANTS (NFTs)
        // Modifiez les "b" (bonus) pour changer l'efficacit√© sur les terrains
        const UNIT_TEMPLATES = [
            // --- COMMON ---
            { baseId: 'c1', name: '26th Infantry', type: 'Infantry', rarity: 'Common', base: 0.3, b: { Beach: 1.0, Plain: 0.22, Forest: 1.0, Hill: 0.72, City: 0.01 } },
            { baseId: 'c2', name: '18th Infantry', type: 'Infantry', rarity: 'Common', base: 0.3, b: { Beach: 1.0, Plain: 0.22, Forest: 1.0, Hill: 0.72, City: 0.01 } },
            { baseId: 'c3', name: '507th Parachute', type: 'Parachute', rarity: 'Common', base: 0.3, b: { Beach: 0.22, Plain: 1.0, Forest: 0.22, Hill: 1.0, City: 0.01 } },
            { baseId: 'c4', name: '32nd Artillery', type: 'Artillery', rarity: 'Common', base: 0.3, b: { Beach: 1.0, Plain: 1.0, Forest: 0.72, Hill: 1.0, City: 0.01 } },
            { baseId: 'c5', name: '82nd Reconn', type: 'Reconn', rarity: 'Common', base: 0.3, b: { Beach: 0.22, Plain: 1.0, Forest: 1.0, Hill: 1.0, City: 1.0 } },
            { baseId: 'c6', name: 'HMS Glasgow', type: 'Ship', rarity: 'Common', base: 0.3, b: { Beach: 1.0, Plain: 0.22, Forest: 1.0, Hill: 0.72, City: 1.0 } },

            // --- UNCOMMON ---
            { baseId: 'uc1', name: '505th Parachute', type: 'Parachute', rarity: 'Uncommon', base: 0.9, b: { Beach: 0.22, Plain: 1.0, Forest: 0.22, Hill: 1.0, City: 0.01 } },
            { baseId: 'uc2', name: '5th Field Artillery', type: 'Artillery', rarity: 'Uncommon', base: 0.9, b: { Beach: 1.0, Plain: 1.0, Forest: 1.0, Hill: 1.0, City: 0.01 } },
            { baseId: 'uc3', name: '325th Glider', type: 'Glider', rarity: 'Uncommon', base: 0.9, b: { Beach: 0.22, Plain: 1.0, Forest: 0.22, Hill: 1.0, City: 0.01 } },
            { baseId: 'uc4', name: 'Anti-tank Xmas', type: 'Anti-Tank', rarity: 'Uncommon', base: 0.9, b: { Beach: 0.22, Plain: 1.0, Forest: 1.0, Hill: 1.0, City: 1.0 } },
            { baseId: 'uc5', name: 'Mosquito B.IV', type: 'Plane', rarity: 'Uncommon', base: 0.9, b: { Beach: 1.0, Plain: 0.22, Forest: 1.0, Hill: 0.72, City: 1.0 } },

            // --- RARE ---
            { baseId: 'r1', name: '16th Infantry', type: 'Infantry', rarity: 'Rare', base: 3.6, b: { Beach: 1.0, Plain: 0.22, Forest: 1.0, Hill: 1.0, City: 0.01 } },
            { baseId: 'r2', name: '635th Anti-Tank', type: 'Anti-Tank', rarity: 'Rare', base: 3.6, b: { Beach: 0.22, Plain: 0.72, Forest: 1.0, Hill: 1.0, City: 1.0 } },
            { baseId: 'r3', name: '346th Guyenne', type: 'Plane', rarity: 'Rare', base: 3.6, b: { Beach: 1.0, Plain: 1.0, Forest: 0.22, Hill: 1.0, City: 1.0 } },
            
            // --- EPIC ---
            { baseId: 'e1', name: '502nd Parachute', type: 'Parachute', rarity: 'Epic', base: 8.42, b: { Beach: 0.22, Plain: 1.0, Forest: 0.22, Hill: 1.0, City: 1.0 } },
            { baseId: 'e2', name: '37th Engineer', type: 'Engineer', rarity: 'Epic', base: 8.42, b: { Beach: 1.0, Plain: 0.22, Forest: 1.0, Hill: 1.0, City: 0.01 } },
            { baseId: 'e3', name: '741st Tank', type: 'Tank', rarity: 'Epic', base: 8.42, b: { Beach: 0.22, Plain: 1.0, Forest: 0.22, Hill: 0.72, City: 0.01 } },
            
            // --- LEGENDARY ---
            { baseId: 'l1', name: '741 Tank Xmas', type: 'Tank', rarity: 'Legendary', base: 57.6, b: { Beach: 0.22, Plain: 1.0, Forest: 0.22, Hill: 0.72, City: 0.01 } },
            { baseId: 'l2', name: 'USS Arkansas', type: 'Ship', rarity: 'Legendary', base: 57.6, b: { Beach: 0.22, Plain: 0.22, Forest: 0.22, Hill: 0.22, City: 1.0 } }
        ];

        // 2. ZONES
        const ZONES = [
            { id: 1, name: 'Beach 1', type: 'Beach', win: 400, usage: 1160, minWeight: 14, officerReq: 1 },
            { id: 4, name: 'Bunker (Checkpoint)', type: 'Beach', win: 3838, usage: 11120, minWeight: 109, officerReq: 4, isCheckpoint: true, bonusToken: "TOKEN-BUNKER" },
            { id: 8, name: 'Camp (Checkpoint)', type: 'Forest', win: 9739, usage: 28220, minWeight: 512, officerReq: 8, isCheckpoint: true, bonusToken: "TOKEN-CAMP" },
            { id: 12, name: 'Radar (Checkpoint)', type: 'Hill', win: 29236, usage: 84712, minWeight: 1358, officerReq: 12, isCheckpoint: true, bonusToken: "TOKEN-RADAR" },
            { id: 16, name: 'HQ (Checkpoint)', type: 'Plain', win: 64884, usage: 188000, minWeight: 2495, officerReq: 16, isCheckpoint: true, bonusToken: "TOKEN-HQ" },
            { id: 17, name: 'City 1', type: 'City', win: 0, usage: 0, entryCostDovX: 777.35, minWeight: 108.53, officerReq: 1, bonusToken: "F1-TOKEN", requiredUnits: ['e6', 'uc6', 'l2'] },
            { id: 20, name: 'Bridge', type: 'City', win: 0, usage: 0, entryCostDovX: 14850, minWeight: 2494, officerReq: 1, bonusToken: "F4-TOKEN", requiredUnits: ['e7', 'l2'] }
        ];

        // 3. USINES (FACTORIES) - CONFIGURATION EXPLICTE
        // output: WAX brut produit par jour (avant co√ªt)
        // cost: Co√ªt en DOV-X pour produire
        const FACTORY_CONFIG = {
            'Common': {
                1: { output: 5.40, cost: 0.4590 },
                2: { output: 12.15, cost: 1.0328 },
                3: { output: 30.38, cost: 2.5819 },
                4: { output: 83.53, cost: 7.1002 },
                5: { output: 1458.00, cost: 123.9300 } // Supreme Blend
            },
            'Rare': {
                1: { output: 16.20, cost: 1.3770 },
                2: { output: 36.45, cost: 3.0983 },
                3: { output: 91.13, cost: 7.7456 },
                4: { output: 250.59, cost: 21.3005 }
            },
            'Epic': {
                1: { output: 48.60, cost: 4.1310 },
                2: { output: 109.35, cost: 9.2948 },
                3: { output: 273.38, cost: 23.2369 },
                4: { output: 751.78, cost: 63.9014 }
            },
            'Legendary': {
                1: { output: 145.80, cost: 12.3930 },
                2: { output: 328.05, cost: 27.8843 },
                3: { output: 820.13, cost: 69.7106 },
                4: { output: 2255.34, cost: 191.7042 }
            }
        };

        // --- G√âN√âRATION DES DONN√âES FINALES (Ne pas toucher) ---
        // Cette partie prend vos configurations ci-dessus et cr√©e les listes compl√®tes
        const generateAllFactories = () => {
            const list = [];
            const types = ['FUEL', 'REPAIR', 'SUPPLY', 'HEALTH'];
            Object.keys(FACTORY_CONFIG).forEach(rarity => {
                Object.keys(FACTORY_CONFIG[rarity]).forEach(lvl => {
                    types.forEach(type => {
                        const stats = FACTORY_CONFIG[rarity][lvl];
                        list.push({
                            id: `${rarity}_${type}_${lvl}`,
                            name: `${rarity} ${type} Lvl ${lvl}`,
                            rarity: rarity, type: type, level: parseInt(lvl),
                            output: stats.output, costDoVX: stats.cost
                        });
                    });
                });
            });
            return list;
        };
        const FACTORIES = generateAllFactories();

        const generateAllUnits = () => {
            let list = [];
            UNIT_TEMPLATES.forEach(tpl => {
                // G√©n√®re F1, F2, F3, F4 pour chaque template
                for (let lvl = 1; lvl <= 4; lvl++) {
                    const multiplier = Math.pow(3, lvl - 1); // F1=1x, F2=3x, etc.
                    list.push({
                        id: `${tpl.baseId}_f${lvl}`,
                        name: `${tpl.rarity} ${tpl.name} (F${lvl})`,
                        type: tpl.type, rarity: tpl.rarity, level: lvl,
                        baseWeight: tpl.base * multiplier,
                        bonuses: tpl.b // H√©rite des bonus d√©finis manuellement
                    });
                }
            });
            return list;
        };
        const ALL_UNITS = generateAllUnits();

        // ==========================================================================================
        //  APPLICATION LOGIC
        // ==========================================================================================

        const { useState, useMemo } = React;

        // Icons
        const IconFactory = () => <span>üè≠</span>;
        const IconSword = () => <span>‚öîÔ∏è</span>;
        const IconPack = () => <span>üì¶</span>;

        function App() {
            const [tab, setTab] = useState('combat');
            const [market, setMarket] = useState(MARKET);
            const [selectedZoneId, setSelectedZoneId] = useState(1);
            
            // Combat Squad State
            const [squad, setSquad] = useState([]);
            const [unitFilter, setUnitFilter] = useState('ALL');

            // Production State
            const [filterRarity, setFilterRarity] = useState('ALL');

            // --- CALCULS COMBAT ---
            const selectedZone = ZONES.find(z => z.id === parseInt(selectedZoneId));

            // Filtre les unit√©s disponibles
            const visibleUnits = useMemo(() => {
                if (unitFilter === 'ALL') return ALL_UNITS;
                return ALL_UNITS.filter(u => u.rarity === unitFilter);
            }, [unitFilter]);

            // Calcul Puissance Squad
            const squadStats = useMemo(() => {
                let weight = 0;
                squad.forEach(u => {
                    const bonus = u.bonuses[selectedZone.type] || 1.0;
                    weight += u.baseWeight * bonus;
                });
                return weight;
            }, [squad, selectedZone]);

            const combatRoi = useMemo(() => {
                const entryCost = selectedZone.entryCostDovX ? selectedZone.entryCostDovX * market.DOVX : (selectedZone.usage * 4 * market.DOVF);
                const win = selectedZone.win * market.DOVX;
                const profit = win - entryCost;
                return { entryCost, win, profit };
            }, [selectedZone, market]);

            const toggleUnit = (unit) => {
                if (squad.find(s => s.id === unit.id)) {
                    setSquad(squad.filter(s => s.id !== unit.id));
                } else {
                    if (squad.length < 10) setSquad([...squad, unit]);
                }
            };

            // --- CALCULS PRODUCTION ---
            const productionList = useMemo(() => {
                return FACTORIES.filter(f => filterRarity === 'ALL' || f.rarity === filterRarity).map(f => {
                    const prodVal = f.output * 24 * market.DOVF; // Valeur Prod (Approx token price same)
                    const costVal = f.costDoVX * 24 * market.DOVX;
                    const profit = prodVal - costVal;
                    return { ...f, profit };
                });
            }, [filterRarity, market]);

            return (
                <div className="p-6 max-w-7xl mx-auto space-y-6">
                    <header className="flex justify-between items-center border-b border-slate-700 pb-4">
                        <h1 className="text-2xl font-bold text-blue-400">DoV Manager v3.0 <span className="text-slate-500 text-sm">Data Edition</span></h1>
                        <div className="flex gap-4">
                            <button onClick={() => setTab('combat')} className={`px-4 py-2 rounded font-bold ${tab==='combat' ? 'bg-blue-600' : 'bg-slate-800'}`}>‚öîÔ∏è Combat Sim</button>
                            <button onClick={() => setTab('prod')} className={`px-4 py-2 rounded font-bold ${tab==='prod' ? 'bg-emerald-600' : 'bg-slate-800'}`}>üè≠ Usines</button>
                        </div>
                    </header>

                    {/* --- ONGLET COMBAT --- */}
                    {tab === 'combat' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            {/* 1. Selection Zone */}
                            <div className="card space-y-4">
                                <h3 className="font-bold text-orange-400">1. Choisir Zone</h3>
                                <select className="w-full bg-slate-900 border border-slate-600 rounded p-2" value={selectedZoneId} onChange={e => setSelectedZoneId(e.target.value)}>
                                    {ZONES.map(z => <option key={z.id} value={z.id}>{z.name} (Min: {z.minWeight})</option>)}
                                </select>
                                <div className="text-sm space-y-2">
                                    <div className="flex justify-between"><span>Type Terrain:</span> <span className="font-bold">{selectedZone.type}</span></div>
                                    <div className="flex justify-between"><span>Poids Requis:</span> <span className="text-yellow-400 font-bold">{selectedZone.minWeight}</span></div>
                                    <div className="flex justify-between"><span>Co√ªt Entr√©e:</span> <span className="text-red-400">-{combatRoi.entryCost.toFixed(2)} WAX</span></div>
                                    <div className="flex justify-between"><span>Gain Victoire:</span> <span className="text-green-400">+{combatRoi.win.toFixed(2)} WAX</span></div>
                                    <div className="flex justify-between border-t border-slate-600 pt-2"><span>Profit Net:</span> <span className={`font-bold ${combatRoi.profit > 0 ? 'text-green-400' : 'text-red-400'}`}>{combatRoi.profit.toFixed(2)} WAX</span></div>
                                </div>
                            </div>

                            {/* 2. Selection Unit√©s (Inventaire) */}
                            <div className="card col-span-2 flex flex-col h-[600px]">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="font-bold text-blue-400">2. S√©lectionner Escouade ({squad.length}/10)</h3>
                                    <div className="flex gap-2">
                                        {['ALL','Common','Uncommon','Rare','Epic','Legendary'].map(r => (
                                            <button key={r} onClick={() => setUnitFilter(r)} className={`text-xs px-2 py-1 rounded ${unitFilter===r ? 'bg-blue-600' : 'bg-slate-700'}`}>{r}</button>
                                        ))}
                                    </div>
                                </div>
                                <div className="flex-1 overflow-y-auto grid grid-cols-2 md:grid-cols-3 gap-2 pr-2">
                                    {visibleUnits.map(unit => {
                                        const bonus = unit.bonuses[selectedZone.type] || 0;
                                        const effective = unit.baseWeight * bonus;
                                        const selected = squad.find(s => s.id === unit.id);
                                        return (
                                            <div key={unit.id} onClick={() => toggleUnit(unit)} className={`p-2 rounded border cursor-pointer text-xs ${selected ? 'bg-blue-900 border-blue-500' : 'bg-slate-900 border-slate-700 hover:border-slate-500'}`}>
                                                <div className="font-bold">{unit.name}</div>
                                                <div className="flex justify-between mt-1">
                                                    <span className="text-slate-400">{unit.type}</span>
                                                    <span className={bonus >= 1 ? 'text-green-400' : 'text-red-400'}>{effective.toFixed(1)} Pts</span>
                                                </div>
                                                <div className="text-[10px] text-slate-500 text-right">x{bonus} sur {selectedZone.type}</div>
                                            </div>
                                        )
                                    })}
                                </div>
                            </div>

                            {/* 3. R√©sultat Squad */}
                            <div className="card lg:col-span-3 bg-slate-800 border-t-4 border-blue-500">
                                <div className="flex justify-between items-center">
                                    <div>
                                        <div className="text-slate-400 text-sm">Puissance Totale</div>
                                        <div className={`text-3xl font-bold ${squadStats >= selectedZone.minWeight ? 'text-green-400' : 'text-red-500'}`}>
                                            {squadStats.toFixed(2)} / {selectedZone.minWeight}
                                        </div>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-xl font-bold text-white">{squadStats >= selectedZone.minWeight ? "VICTOIRE" : "D√âFAITE"}</div>
                                        <div className="text-sm text-slate-400">{squad.length} unit√©s engag√©es</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* --- ONGLET PRODUCTION --- */}
                    {tab === 'prod' && (
                        <div className="space-y-4">
                            <div className="flex gap-2">
                                {['ALL','Common','Rare','Epic','Legendary'].map(r => (
                                    <button key={r} onClick={() => setFilterRarity(r)} className={`px-3 py-1 rounded font-bold ${filterRarity===r ? 'bg-emerald-600' : 'bg-slate-700'}`}>{r}</button>
                                ))}
                            </div>
                            <div className="overflow-x-auto">
                                <table className="w-full text-left text-sm">
                                    <thead className="bg-slate-800 text-slate-400">
                                        <tr><th className="p-3">Nom</th><th className="p-3 text-right">Prod (WAX/j)</th><th className="p-3 text-right">Co√ªt (WAX/j)</th><th className="p-3 text-right">Profit Net</th></tr>
                                    </thead>
                                    <tbody>
                                        {productionList.map(f => (
                                            <tr key={f.id} className="border-b border-slate-700 hover:bg-slate-800">
                                                <td className="p-3 font-bold">{f.name}</td>
                                                <td className="p-3 text-right text-emerald-400">+{(f.output * 24 * market.DOVF).toFixed(4)}</td>
                                                <td className="p-3 text-right text-red-400">-{(f.costDoVX * 24 * market.DOVX).toFixed(4)}</td>
                                                <td className="p-3 text-right font-bold text-white">{f.profit > 0 ? '+' : ''}{f.profit.toFixed(4)}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
