<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DoV Tactical Manager</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #0f172a; color: #f8fafc; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #3b82f6; cursor: pointer; margin-top: -6px; box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #334155; border-radius: 2px; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        // ==========================================================================================
        //  1. DONNÉES DE JEU (BASE)
        // ==========================================================================================

        const INITIAL_MARKET = { WAX: 1, DOVX: 0.005285, DOVF: 0.00045, DOVR: 0.00045, DOVS: 0.00045, DOVH: 0.00045 };

        const ZONES = [
            { id: 1, name: 'Beach 1', type: 'Beach', win: 400, usage: 1160, minWeight: 14, officerReq: 1 },
            { id: 2, name: 'Beach 2', type: 'Beach', win: 2405, usage: 6968, minWeight: 28, officerReq: 2 },
            { id: 3, name: 'Beach 3', type: 'Beach', win: 3037, usage: 8800, minWeight: 55, officerReq: 3 },
            { id: 4, name: 'Bunker', type: 'Beach', win: 3838, usage: 11120, minWeight: 109, officerReq: 4, isCheckpoint: true, bonusToken: "TOKEN-BUNKER" },
            { id: 5, name: 'Forest 1', type: 'Forest', win: 4840, usage: 14024, minWeight: 219, officerReq: 5 },
            { id: 6, name: 'Forest 2', type: 'Forest', win: 6110, usage: 17704, minWeight: 342, officerReq: 6 },
            { id: 7, name: 'Forest 3', type: 'Forest', win: 7714, usage: 22352, minWeight: 450, officerReq: 7 },
            { id: 8, name: 'Camp', type: 'Forest', win: 9739, usage: 28220, minWeight: 512, officerReq: 8, isCheckpoint: true, bonusToken: "TOKEN-CAMP" },
            { id: 9, name: 'Hill 1', type: 'Hill', win: 12788, usage: 37052, minWeight: 695, officerReq: 9 },
            { id: 10, name: 'Hill 2', type: 'Hill', win: 16791, usage: 48652, minWeight: 869, officerReq: 10 },
            { id: 11, name: 'Hill 3', type: 'Hill', win: 22266, usage: 64516, minWeight: 1086, officerReq: 11 },
            { id: 12, name: 'Radar', type: 'Hill', win: 29236, usage: 84712, minWeight: 1358, officerReq: 12, isCheckpoint: true, bonusToken: "TOKEN-RADAR" },
            { id: 13, name: 'Plain 1', type: 'Plain', win: 34300, usage: 99384, minWeight: 1697, officerReq: 13 },
            { id: 14, name: 'Plain 2', type: 'Plain', win: 43385, usage: 125708, minWeight: 1866, officerReq: 14 },
            { id: 15, name: 'Plain 3', type: 'Plain', win: 52171, usage: 151164, minWeight: 2052, officerReq: 15 },
            { id: 16, name: 'HQ', type: 'Plain', win: 64884, usage: 188000, minWeight: 2495, officerReq: 16, isCheckpoint: true, bonusToken: "TOKEN-HQ" },
            { id: 17, name: 'City 1', type: 'City', win: 0, usage: 0, entryCostDovX: 777.35, minWeight: 108.53, officerReq: 1, bonusToken: "F1-TOKEN-CITY", requiredUnits: ['e6', 'uc6', 'l2'] },
            { id: 20, name: 'Bridge', type: 'City', win: 0, usage: 0, entryCostDovX: 14850, minWeight: 2494, officerReq: 1, bonusToken: "F4-TOKEN-BRIDGE", requiredUnits: ['e7', 'l2'] }
        ];

        const CHEST_DATA = {
            'Bunker': { zone: 4, name: 'PACK Bunker', tokenCost: 27, drops: [{ type: 'building', pool: [{ id: 'c_f1', name: 'C_F1', prob: 100 }] }] },
            'Camp': { zone: 8, name: 'PACK Camp', tokenCost: 27, drops: [{ type: 'building', pool: [{ id: 'r_f1', name: 'R_F1', prob: 100 }] }] },
            'Radar': { zone: 12, name: 'PACK Radar', tokenCost: 27, drops: [{ type: 'building', pool: [{ id: 'e_f1', name: 'E_F1', prob: 100 }] }] },
            'HQ': { zone: 16, name: 'PACK HQ', tokenCost: 27, drops: [{ type: 'building', pool: [{ id: 'l_f1', name: 'L_F1', prob: 100 }] }] }
        };

        const generateFactories = () => {
            const types = ['FUEL', 'REPAIR', 'SUPPLY', 'HEALTH'];
            const rarities = [
                { name: 'Common', levels: [ { l: 1, out: 5.40, cost: 0.4590 }, { l: 2, out: 12.15, cost: 1.0328 }, { l: 3, out: 30.38, cost: 2.5819 }, { l: 4, out: 83.53, cost: 7.1002 }, { l: 5, out: 1458.00, cost: 123.9300, isBlend: true } ]},
                { name: 'Rare', levels: [ { l: 1, out: 16.20, cost: 1.3770 }, { l: 2, out: 36.45, cost: 3.0983 }, { l: 3, out: 91.13, cost: 7.7456 }, { l: 4, out: 250.59, cost: 21.3005 } ]},
                { name: 'Epic', levels: [ { l: 1, out: 48.60, cost: 4.1310 }, { l: 2, out: 109.35, cost: 9.2948 }, { l: 3, out: 273.38, cost: 23.2369 }, { l: 4, out: 751.78, cost: 63.9014 } ]},
                { name: 'Legendary', levels: [ { l: 1, out: 145.80, cost: 12.3930 }, { l: 2, out: 328.05, cost: 27.8843 }, { l: 3, out: 820.13, cost: 69.7106 }, { l: 4, out: 2255.34, cost: 191.7042 } ]},
                { name: 'Supreme', levels: [ { l: 1, out: 2255.34, cost: 191.7042 } ]}
            ];
            let list = [];
            types.forEach(type => {
                rarities.forEach(rarity => {
                    rarity.levels.forEach(level => {
                        let name = `${rarity.name} ${type} ${level.l}`;
                        if (level.isBlend) name = `Supreme ${rarity.name} ${type} (Blend 10x F4)`;
                        list.push({
                            id: `${rarity.name.charAt(0)}_${type.charAt(0)}${level.l}`,
                            name: name,
                            type: type, rarity: rarity.name, level: level.l, output: level.out, costDoVX: level.cost,
                            // Metadata for valuation
                            accountsNeeded: level.l === 5 ? 270/4 : (Math.pow(3, level.l-1)/4), 
                            equivalentF1s: Math.pow(3, level.l-1)
                        });
                    });
                });
            });
            return list;
        };
        const FACTORIES = generateFactories();

        // Basic Unit Templates for Blending
        const UNIT_TEMPLATES = [
            { baseId: 'c1', name: 'Infantry', rarity: 'Common' },
            { baseId: 'c2', name: 'Tank', rarity: 'Common' },
        ];
        const BLENDABLE_UNITS = UNIT_TEMPLATES.map(t => ({ id: t.baseId, name: t.name, level: 1, rarity: t.rarity }));

        // ==========================================================================================
        //  2. MOTEUR REACT
        // ==========================================================================================

        const { useState, useEffect, useMemo } = React;

        // Components
        const Card = ({ children, className = "" }) => <div className={`bg-slate-800 border border-slate-700 rounded-lg p-4 shadow-xl ${className}`}>{children}</div>;
        const Badge = ({ children, color = "blue" }) => <span className={`px-2 py-1 rounded text-xs font-bold border bg-${color}-900/30 text-${color}-300 border-${color}-700`}>{children}</span>;
        
        // Icons
        const Icon = ({ path }) => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d={path} /></svg>;
        const Icons = {
            Factory: "M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",
            Combat: "M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",
            Pack: "m16.5 9.4-9-5.19M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",
            Token: "M6 3h12l4 6-10 13L2 9Z",
            Valuation: "m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z M7 21h10 M12 3v18 M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",
            Blend: "M10 2v7.31 M14 2v7.31 M8.5 2h7 M14 9.3a6.5 6.5 0 1 1-4 0 M5.52 16h12.96"
        };

        function DoVManager() {
            // States
            const [activeTab, setActiveTab] = useState('account_sim');
            const [market, setMarket] = useState(INITIAL_MARKET);
            const [waxPrice, setWaxPrice] = useState(0.008);
            
            // Sim States
            const [accBuildings, setAccBuildings] = useState([FACTORIES[0].id, FACTORIES[1].id, FACTORIES[2].id, FACTORIES[3].id]);
            const [accDivisions, setAccDivisions] = useState([1, 1, 1]);
            const [roiTarget, setRoiTarget] = useState(365);
            const [cpuCost, setCpuCost] = useState(50); // WAX staked per account

            // Blending State
            const [blendUnit, setBlendUnit] = useState(BLENDABLE_UNITS[0]?.id);
            const [blendCount, setBlendCount] = useState(0);

            // Pack State
            const [packBuilder, setPackBuilder] = useState({ name: 'Mon Pack', price: 100, contents: [] });
            
            // --- 1. CALCULS DE BASE ---
            const factoryAnalysis = useMemo(() => {
                return FACTORIES.map(f => {
                    const dailyProd = f.output * 24 * market[`DOV${f.type.charAt(0)}`];
                    const dailyCost = f.costDoVX * 24 * market.DOVX;
                    const dailyNet = dailyProd - dailyCost;
                    
                    // Valuation: Profit sur ROI Target + Economie CPU
                    const prodVal = dailyNet * roiTarget;
                    const savedAccounts = Math.max(0, f.accountsNeeded - 1);
                    const cpuVal = savedAccounts * cpuCost;
                    const fairValueWax = prodVal + cpuVal;

                    return { ...f, dailyProd, dailyCost, dailyNet, fairValueWax, cpuVal };
                });
            }, [market, roiTarget, cpuCost]);

            // --- 2. VALEUR DU TOKEN (Dépend de Factory Analysis) ---
            const tokenValue = useMemo(() => {
                // Logic: 1 F5 Supreme = 270 F1 = 270 Coffres = 7290 Tokens
                const f5 = factoryAnalysis.find(f => f.level === 5);
                if (!f5) return 0;
                
                const f5Value = f5.fairValueWax;
                const totalTokens = 270 * 27; // 10 F4 * 27 F1/F4 * 27 Tokens/Chest
                return f5Value / totalTokens;
            }, [factoryAnalysis]);

            // --- 3. ANALYSE ZONES (Dépend de Token Value) ---
            const zonesAnalysis = useMemo(() => {
                return ZONES.map(z => {
                    const cost = z.usage ? z.usage * 4 * market.DOVF : (z.entryCostDovX || 0) * market.DOVX;
                    const reward = z.win * market.DOVX;
                    
                    // Token Gain Value
                    const tokenVal = z.bonusToken ? tokenValue : 0; 
                    const totalProfit = (reward - cost) + tokenVal;
                    const roi = cost > 0 ? (totalProfit / cost) * 100 : 0;

                    return { ...z, cost, reward, tokenVal, totalProfit, roi };
                });
            }, [market, tokenValue]);

            // --- 4. ANALYSE COMPTE (Dépend de Factory + Zones) ---
            const accountStats = useMemo(() => {
                let prod = 0, maint = 0;
                accBuildings.forEach(id => {
                    const f = factoryAnalysis.find(x => x.id === id);
                    if(f) { prod += f.dailyProd; maint += f.dailyCost; }
                });

                let combatNet = 0;
                accDivisions.forEach(zid => {
                    const z = zonesAnalysis.find(x => x.id == zid);
                    if(z) combatNet += z.totalProfit;
                });

                const dailyNet = (prod - maint) + combatNet;
                return { 
                    prod, maint, combatNet, dailyNet,
                    monthlyNet: dailyNet * 30,
                    yearlyNet: dailyNet * 365,
                    usdDaily: dailyNet * waxPrice
                };
            }, [accBuildings, accDivisions, factoryAnalysis, zonesAnalysis, waxPrice]);

            // --- 5. BLEND LOGIC ---
            const blendStats = useMemo(() => {
                if(!blendCount) return null;
                const f2 = Math.floor(blendCount / 3);
                const f3 = Math.floor(blendCount / 9);
                const f4 = Math.floor(blendCount / 27);
                const f5 = Math.floor(blendCount / 270);
                return { f2, f3, f4, f5 };
            }, [blendCount]);

            // --- 6. PACK LOGIC ---
            const packStats = useMemo(() => {
                let dailyProd = 0, dailyCost = 0;
                packBuilder.contents.forEach(item => {
                    const f = factoryAnalysis.find(x => x.id === item.id);
                    if(f) {
                        dailyProd += f.dailyProd * item.qty;
                        dailyCost += f.dailyCost * item.qty;
                    }
                });
                const dailyNet = dailyProd - dailyCost;
                const roiDays = dailyNet > 0 ? packBuilder.price / dailyNet : 0;
                return { dailyProd, dailyCost, dailyNet, roiDays };
            }, [packBuilder, factoryAnalysis]);

            // --- RENDER HELPERS ---
            const formatW = (v) => `${v.toLocaleString(undefined, {maximumFractionDigits:2})} W`;
            const formatUsd = (v) => `$${(v * waxPrice).toFixed(2)}`;

            // --- PACK HANDLERS ---
            const addToPack = () => {
                const existing = packBuilder.contents.find(c => c.id === selectedFactory);
                if(existing) {
                    setPackBuilder({...packBuilder, contents: packBuilder.contents.map(c => c.id === selectedFactory ? {...c, qty: c.qty+1} : c)});
                } else {
                    setPackBuilder({...packBuilder, contents: [...packBuilder.contents, {id: selectedFactory, qty: 1}]});
                }
            };

            return (
                <div className="p-6 max-w-7xl mx-auto space-y-6">
                    {/* HEADER */}
                    <div className="flex justify-between items-center border-b border-slate-700 pb-4">
                        <div>
                            <h1 className="text-2xl font-bold text-blue-400">DoV TACTICAL MANAGER</h1>
                            <p className="text-xs text-slate-400">Outil de Gestion & Simulation Stratégique</p>
                        </div>
                        <div className="flex gap-4 text-xs">
                            <div className="bg-slate-800 p-2 rounded">
                                <div className="text-slate-400">Prix WAX</div>
                                <input type="number" value={waxPrice} onChange={e => setWaxPrice(parseFloat(e.target.value))} className="bg-transparent font-bold w-16" step="0.001"/>
                            </div>
                            <div className="bg-slate-800 p-2 rounded">
                                <div className="text-slate-400">DOV-X</div>
                                <input type="number" value={market.DOVX} onChange={e => setMarket({...market, DOVX: parseFloat(e.target.value)})} className="bg-transparent text-yellow-400 font-bold w-20" step="0.0001"/>
                            </div>
                        </div>
                    </div>

                    {/* NAVIGATION */}
                    <div className="flex gap-2 overflow-x-auto pb-2">
                        {[
                            {id: 'account_sim', icon: Icons.Factory, label: 'COMPTE COMPLET'},
                            {id: 'zone_roi_advanced', icon: Icons.Token, label: 'ROI TOKENS (Expert)'},
                            {id: 'valuation', icon: Icons.Valuation, label: 'VALORISATION'},
                            {id: 'combat', icon: Icons.Combat, label: 'COMBAT'},
                            {id: 'production', icon: Icons.Factory, label: 'USINES'},
                            {id: 'packs', icon: Icons.Pack, label: 'PACKS'},
                            {id: 'blending', icon: Icons.Blend, label: 'BLEND'}
                        ].map(tab => (
                            <button key={tab.id} onClick={() => setActiveTab(tab.id)} 
                                className={`px-4 py-2 rounded font-bold text-sm whitespace-nowrap flex items-center gap-2 ${activeTab === tab.id ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-400'}`}>
                                <Icon path={tab.icon} /> {tab.label}
                            </button>
                        ))}
                    </div>

                    {/* === TAB: COMPTE COMPLET === */}
                    {activeTab === 'account_sim' && (
                        <div className="space-y-6 animate-fade-in">
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <Card>
                                    <h3 className="font-bold text-orange-400 mb-4">Production (4 Slots)</h3>
                                    {accBuildings.map((id, i) => (
                                        <div key={i} className="flex gap-2 mb-2">
                                            <span className="text-slate-500 w-6">#{i+1}</span>
                                            <select className="flex-1 bg-slate-900 border border-slate-700 rounded text-sm p-1" value={id} onChange={e => { const n = [...accBuildings]; n[i] = e.target.value; setAccBuildings(n); }}>
                                                {FACTORIES.map(f => <option key={f.id} value={f.id}>{f.name}</option>)}
                                            </select>
                                        </div>
                                    ))}
                                    <div className="mt-4 pt-2 border-t border-slate-700 flex justify-between text-sm">
                                        <span className="text-emerald-400">Prod Brut: +{formatW(accountStats.prod)}</span>
                                        <span className="text-red-400">Maint: -{formatW(accountStats.maint)}</span>
                                    </div>
                                </Card>
                                <Card>
                                    <h3 className="font-bold text-blue-400 mb-4">Combat (3 Divisions)</h3>
                                    {accDivisions.map((id, i) => (
                                        <div key={i} className="flex gap-2 mb-2">
                                            <span className="text-slate-500 w-12">Div {i+1}</span>
                                            <select className="flex-1 bg-slate-900 border border-slate-700 rounded text-sm p-1" value={id} onChange={e => { const n = [...accDivisions]; n[i] = parseInt(e.target.value); setAccDivisions(n); }}>
                                                {ZONES.map(z => <option key={z.id} value={z.id}>{z.name}</option>)}
                                            </select>
                                        </div>
                                    ))}
                                    <div className="mt-4 pt-2 border-t border-slate-700 text-right text-sm">
                                        <span className="text-emerald-400 font-bold">Net Combat: {accountStats.combatNet > 0 ? '+' : ''}{formatW(accountStats.combatNet)}</span>
                                    </div>
                                </Card>
                            </div>

                            {/* BILAN */}
                            <Card className="border-t-4 border-emerald-500 bg-slate-800/80">
                                <div className="text-center mb-4 text-emerald-400 font-bold tracking-widest text-xs uppercase">Bilan Net Consolidé</div>
                                <div className="grid grid-cols-3 gap-4 text-center">
                                    <div className="p-2 bg-slate-900/50 rounded">
                                        <div className="text-xs text-slate-400">JOUR</div>
                                        <div className="text-xl font-bold text-white">{accountStats.dailyNet > 0 ? '+' : ''}{formatW(accountStats.dailyNet)}</div>
                                        <div className="text-xs text-emerald-500">{formatUsd(accountStats.dailyNet)}</div>
                                    </div>
                                    <div className="p-2 bg-slate-900/50 rounded border border-slate-700">
                                        <div className="text-xs text-purple-300">MOIS (30j)</div>
                                        <div className="text-xl font-bold text-purple-100">{accountStats.monthlyNet > 0 ? '+' : ''}{formatW(accountStats.monthlyNet)}</div>
                                        <div className="text-xs text-emerald-500">{formatUsd(accountStats.monthlyNet)}</div>
                                    </div>
                                    <div className="p-2 bg-slate-900/50 rounded">
                                        <div className="text-xs text-slate-400">ANNÉE (365j)</div>
                                        <div className="text-xl font-bold text-white">{accountStats.yearlyNet > 0 ? '+' : ''}{formatW(accountStats.yearlyNet)}</div>
                                        <div className="text-xs text-emerald-500">{formatUsd(accountStats.yearlyNet)}</div>
                                    </div>
                                </div>
                            </Card>
                        </div>
                    )}

                    {/* === TAB: ROI AVANCE (TOKEN) === */}
                    {activeTab === 'zone_roi_advanced' && (
                        <div className="space-y-6 animate-fade-in">
                            <Card className="border-l-4 border-indigo-500">
                                <div className="flex flex-col md:flex-row gap-6">
                                    <div className="flex-1">
                                        <h3 className="text-lg font-bold text-white mb-2">Valorisation du Token</h3>
                                        <p className="text-sm text-slate-400 mb-4">Calculée sur le coût de création d'une F5 Supreme via le Blend.</p>
                                        <div className="grid grid-cols-3 gap-4 text-center items-center bg-slate-900 p-4 rounded">
                                            <div>
                                                <div className="text-xs text-slate-500">Valeur Cible F5</div>
                                                <div className="text-emerald-400 font-bold">{factoryAnalysis.find(f=>f.level===5)?.fairValueWax.toFixed(0)} W</div>
                                            </div>
                                            <div className="text-2xl text-slate-600">÷</div>
                                            <div>
                                                <div className="text-xs text-slate-500">Coût Blend</div>
                                                <div className="font-bold text-white">7 290 Tokens</div>
                                                <div className="text-[10px] text-slate-600">(270 F1 x 27 Tokens)</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="bg-indigo-900/30 p-4 rounded border border-indigo-500 flex flex-col justify-center items-center min-w-[200px]">
                                        <div className="text-xs text-indigo-300 uppercase font-bold mb-1">Valeur 1 Token</div>
                                        <div className="text-3xl font-mono text-white">{tokenValue.toFixed(2)} WAX</div>
                                        <div className="text-sm text-indigo-400">{formatUsd(tokenValue)}</div>
                                    </div>
                                </div>
                            </Card>

                            <table className="w-full text-left text-sm border-collapse">
                                <thead className="bg-slate-800 text-slate-400 uppercase text-xs">
                                    <tr>
                                        <th className="p-3">Zone</th>
                                        <th className="p-3 text-right">Coût Entrée</th>
                                        <th className="p-3 text-right">Gain DOV-X</th>
                                        <th className="p-3 text-right text-indigo-300 bg-indigo-900/20">Gain Token (Unit)</th>
                                        <th className="p-3 text-right text-white">Profit Net Total</th>
                                        <th className="p-3 text-center">ROI</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {zonesAnalysis.filter(z => z.bonusToken).map(z => (
                                        <tr key={z.id} className="border-b border-slate-700 hover:bg-slate-800">
                                            <td className="p-3 font-bold">{z.name}</td>
                                            <td className="p-3 text-right text-red-400">-{formatW(z.cost)}</td>
                                            <td className="p-3 text-right text-emerald-400">+{formatW(z.reward)}</td>
                                            <td className="p-3 text-right text-indigo-300 bg-indigo-900/10 font-bold">+{formatW(z.tokenVal)}</td>
                                            <td className="p-3 text-right font-bold text-white">{formatW(z.totalProfit)}</td>
                                            <td className="p-3 text-center"><Badge color={z.roi > 0 ? 'green' : 'red'}>{z.roi.toFixed(1)}%</Badge></td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}

                    {/* === TAB: PACKS === */}
                    {activeTab === 'packs' && (
                        <div className="space-y-6 animate-fade-in">
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <Card>
                                    <h3 className="font-bold text-purple-400 mb-4">Configuration du Pack</h3>
                                    <div className="space-y-4">
                                        <div className="flex gap-4">
                                            <div className="flex-1">
                                                <label className="text-xs text-slate-400">Prix Pack ($)</label>
                                                <input type="number" value={packBuilder.price} onChange={e => setPackBuilder({...packBuilder, price: parseFloat(e.target.value)})} className="w-full bg-slate-900 border border-purple-500 rounded p-2 text-white font-bold"/>
                                            </div>
                                            <div className="flex-1">
                                                <label className="text-xs text-slate-400">Eq. WAX</label>
                                                <div className="p-2 text-slate-300">{formatW(packBuilder.price / waxPrice)}</div>
                                            </div>
                                        </div>
                                        <div>
                                            <label className="text-xs text-slate-400">Ajouter Bâtiment</label>
                                            <div className="flex gap-2">
                                                <select className="flex-1 bg-slate-900 border border-slate-600 rounded p-2" value={selectedFactory} onChange={e => setSelectedFactory(e.target.value)}>
                                                    {FACTORIES.map(f => <option key={f.id} value={f.id}>{f.name}</option>)}
                                                </select>
                                                <button onClick={addToPack} className="bg-purple-600 text-white p-2 rounded"><Icon path={Icons.Pack}/></button>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="mt-6">
                                        <h4 className="text-xs uppercase text-slate-500 mb-2">Contenu</h4>
                                        {packBuilder.contents.map((item, i) => {
                                            const f = factoryAnalysis.find(x => x.id === item.id);
                                            return (
                                                <div key={i} className="flex justify-between items-center bg-slate-900 p-2 rounded mb-1 border border-slate-700">
                                                    <div className="text-sm">{f.name} x{item.qty}</div>
                                                    <div className="text-xs text-right">
                                                        <div className="text-emerald-400">Prod Brut: {formatW(f.dailyProd * item.qty)}</div>
                                                        <div className="text-red-400">Coût Maint: -{formatW(f.dailyCost * item.qty)}</div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </Card>
                                <Card>
                                    <h3 className="font-bold text-white mb-4">Analyse Rentabilité</h3>
                                    <div className="space-y-4 text-center">
                                        <div className="grid grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <div className="text-slate-500 text-xs">Production Brute / Jour</div>
                                                <div className="text-emerald-400 font-bold">{formatW(packStats.dailyProd)}</div>
                                            </div>
                                            <div>
                                                <div className="text-slate-500 text-xs">Coût Maintenance / Jour</div>
                                                <div className="text-red-400 font-bold">-{formatW(packStats.dailyCost)}</div>
                                            </div>
                                        </div>
                                        <div className="bg-slate-900 p-4 rounded border border-slate-700">
                                            <div className="text-slate-400 text-xs uppercase mb-1">Profit Net Quotidien</div>
                                            <div className="text-2xl font-bold text-white">{formatW(packStats.dailyNet)}</div>
                                            <div className="text-emerald-500 text-sm">{formatUsd(packStats.dailyNet)} / jour</div>
                                        </div>
                                        <div>
                                            <div className="text-xs text-slate-500 uppercase">Retour sur Investissement</div>
                                            <div className="text-4xl font-bold text-white">{Math.ceil(packStats.roiDays)} <span className="text-lg font-normal text-slate-400">Jours</span></div>
                                        </div>
                                    </div>
                                </Card>
                            </div>
                        </div>
                    )}

                    {/* === TAB: BLENDING === */}
                    {activeTab === 'blending' && (
                        <div className="space-y-6 animate-fade-in">
                            <Card>
                                <h3 className="font-bold text-indigo-400 mb-4">Simulateur de Fusion</h3>
                                <div className="flex gap-4 items-end mb-6">
                                    <div>
                                        <label className="text-xs text-slate-400 block mb-1">Nombre de F1</label>
                                        <input type="number" value={blendCount} onChange={e => setBlendCount(parseInt(e.target.value)||0)} className="bg-slate-900 border border-slate-600 rounded p-2 text-white w-32"/>
                                    </div>
                                    <div className="text-sm text-slate-500 pb-2">➜ Entrez votre stock pour voir le résultat.</div>
                                </div>
                                {blendStats && (
                                    <div className="grid grid-cols-4 gap-4 text-center">
                                        <div className="bg-slate-900 p-4 rounded border border-slate-700">
                                            <div className="text-xs text-slate-400">F2 (Rare)</div>
                                            <div className="text-xl font-bold text-white">{blendStats.f2}</div>
                                        </div>
                                        <div className="bg-slate-900 p-4 rounded border border-slate-700">
                                            <div className="text-xs text-slate-400">F3 (Epic)</div>
                                            <div className="text-xl font-bold text-white">{blendStats.f3}</div>
                                        </div>
                                        <div className="bg-indigo-900/20 p-4 rounded border border-indigo-500">
                                            <div className="text-xs text-indigo-300 font-bold">F4 (Legendary)</div>
                                            <div className="text-2xl font-bold text-white">{blendStats.f4}</div>
                                        </div>
                                        <div className="bg-red-900/20 p-4 rounded border border-red-500">
                                            <div className="text-xs text-red-300 font-bold">F5 (Supreme)</div>
                                            <div className="text-2xl font-bold text-white">{blendStats.f5}</div>
                                            <div className="text-[10px] text-slate-400 mt-1">Nécessite {blendStats.f5 * 270} F1</div>
                                        </div>
                                    </div>
                                )}
                            </Card>
                        </div>
                    )}

                    {/* === TAB: VALORISATION === */}
                    {activeTab === 'valuation' && (
                        <div className="space-y-6 animate-fade-in">
                            <Card>
                                <div className="flex justify-between mb-4">
                                    <h3 className="font-bold text-cyan-400">Valorisation des Actifs</h3>
                                    <div className="flex gap-4 text-xs">
                                        <div className="bg-slate-900 p-1 px-2 rounded border border-slate-700">ROI Cible: <input type="number" value={roiTarget} onChange={e=>setRoiTarget(parseInt(e.target.value))} className="bg-transparent w-10 text-center font-bold"/>j</div>
                                        <div className="bg-slate-900 p-1 px-2 rounded border border-slate-700">CPU/Compte: <input type="number" value={cpuCost} onChange={e=>setCpuCost(parseInt(e.target.value))} className="bg-transparent w-10 text-center font-bold"/> W</div>
                                    </div>
                                </div>
                                <table className="w-full text-left text-sm">
                                    <thead className="text-slate-500 text-xs uppercase border-b border-slate-700">
                                        <tr><th className="p-2">Actif</th><th className="p-2 text-right">Prod (Net)</th><th className="p-2 text-right">Gain CPU</th><th className="p-2 text-right">Valeur Juste</th></tr>
                                    </thead>
                                    <tbody>
                                        {factoryAnalysis.map(f => (
                                            <tr key={f.id} className="border-b border-slate-700/50 hover:bg-slate-800">
                                                <td className="p-2 font-bold">{f.name}</td>
                                                <td className="p-2 text-right text-slate-300">{formatW(f.dailyNet * roiTarget)}</td>
                                                <td className="p-2 text-right text-indigo-300">+{formatW(f.cpuVal)}</td>
                                                <td className="p-2 text-right font-bold text-cyan-400">{formatW(f.fairValueWax)}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </Card>
                        </div>
                    )}

                    {/* === PLACEHOLDER TABS === */}
                    {(activeTab === 'production' || activeTab === 'combat' || activeTab === 'chests') && (
                        <div className="p-8 text-center text-slate-500 italic border border-dashed border-slate-700 rounded">
                            Module complet disponible (voir code). Utilisez les autres onglets pour l'instant.
                        </div>
                    )}

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DoVManager />);
    </script>
</body>
</html>
