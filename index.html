<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DoV Manager v3.4.1 (Stable + Monitoring)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #0f172a; color: #f8fafc; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #3b82f6; cursor: pointer; margin-top: -6px; box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #334155; border-radius: 2px; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        // ==========================================================================================
        //  1. DONN√âES DE JEU
        // ==========================================================================================

        const INITIAL_MARKET = { WAX: 1, DOVX: 0.005285, DOVF: 0.00045, DOVR: 0.00045, DOVS: 0.00045, DOVH: 0.00045 };

        // --- FACTORIES ---
        const generateFactories = () => {
            const types = ['FUEL', 'REPAIR', 'SUPPLY', 'HEALTH'];
            const rarities = [
                { name: 'Common', levels: [ { l: 1, out: 5.40, cost: 0.4590 }, { l: 2, out: 12.15, cost: 1.0328 }, { l: 3, out: 30.38, cost: 2.5819 }, { l: 4, out: 83.53, cost: 7.1002 }, { l: 5, out: 1458.00, cost: 123.9300, isBlend: true } ]},
                { name: 'Rare', levels: [ { l: 1, out: 16.20, cost: 1.3770 }, { l: 2, out: 36.45, cost: 3.0983 }, { l: 3, out: 91.13, cost: 7.7456 }, { l: 4, out: 250.59, cost: 21.3005 } ]},
                { name: 'Epic', levels: [ { l: 1, out: 48.60, cost: 4.1310 }, { l: 2, out: 109.35, cost: 9.2948 }, { l: 3, out: 273.38, cost: 23.2369 }, { l: 4, out: 751.78, cost: 63.9014 } ]},
                { name: 'Legendary', levels: [ { l: 1, out: 145.80, cost: 12.3930 }, { l: 2, out: 328.05, cost: 27.8843 }, { l: 3, out: 820.13, cost: 69.7106 }, { l: 4, out: 2255.34, cost: 191.7042 } ]},
                { name: 'Supreme', levels: [ { l: 1, out: 2255.34, cost: 191.7042 } ]}
            ];
            let list = [];
            types.forEach(type => {
                rarities.forEach(rarity => {
                    rarity.levels.forEach(level => {
                        let name = `${rarity.name} ${type} ${level.l}`;
                        if (level.isBlend) name = `Supreme ${rarity.name} ${type} (Blend 10x F4)`;
                        
                        // Calcul equivalent F1 pour la densit√©
                        let costInF1s = 1;
                        if (level.l === 2) costInF1s = 3;
                        if (level.l === 3) costInF1s = 9;
                        if (level.l === 4) costInF1s = 27;
                        if (level.l === 5) costInF1s = 270;

                        list.push({
                            id: `${rarity.name.charAt(0)}_${type.charAt(0)}${level.l}`,
                            name: name,
                            type: type, rarity: rarity.name, level: level.l, 
                            output: level.out, costDoVX: level.cost,
                            equivalentF1s: costInF1s,
                            accountsNeeded: costInF1s / 4 // 4 slots par compte
                        });
                    });
                });
            });
            return list;
        };
        const FACTORIES = generateFactories();

        // --- ZONES ---
        const ZONES = [
            { id: 1, name: 'Beach 1', type: 'Beach', win: 400, usage: 1160 },
            { id: 2, name: 'Beach 2', type: 'Beach', win: 2405, usage: 6968 },
            { id: 3, name: 'Beach 3', type: 'Beach', win: 3037, usage: 8800 },
            { id: 4, name: 'Bunker', type: 'Beach', win: 3838, usage: 11120, bonusToken: "TOKEN-BUNKER", minWeight: 109 },
            { id: 5, name: 'Forest 1', type: 'Forest', win: 4840, usage: 14024 },
            { id: 8, name: 'Camp', type: 'Forest', win: 9739, usage: 28220, bonusToken: "TOKEN-CAMP", minWeight: 512 },
            { id: 12, name: 'Radar', type: 'Hill', win: 29236, usage: 84712, bonusToken: "TOKEN-RADAR", minWeight: 1358 },
            { id: 16, name: 'HQ', type: 'Plain', win: 64884, usage: 188000, bonusToken: "TOKEN-HQ", minWeight: 2495 },
            { id: 17, name: 'City 1', type: 'City', win: 0, usage: 0, entryCostDovX: 777.35, bonusToken: "F1-TOKEN", minWeight: 108 },
            { id: 20, name: 'Bridge', type: 'City', win: 0, usage: 0, entryCostDovX: 14850, bonusToken: "F4-TOKEN", minWeight: 2494 }
        ];

        // ==========================================================================================
        //  2. MOTEUR REACT
        // ==========================================================================================

        const { useState, useEffect, useMemo } = React;

        // ICONS
        const IconNetwork = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2zm0 18a8 8 0 1 1 8-8 8 8 0 0 1-8 8z M12 6v6l4 2"/></svg>;
        const IconFactory = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/></svg>;
        const IconPack = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m16.5 9.4-9-5.19M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>;
        const IconValuation = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="M7 21h10"/><path d="M12 3v18"/></svg>;
        const IconTrash = () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>;
        const IconPlus = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;

        function DoVManager() {
            // STATES
            const [activeTab, setActiveTab] = useState('account_sim');
            const [marketPrices, setMarketPrices] = useState(INITIAL_MARKET);
            const [waxPriceUsd, setWaxPriceUsd] = useState(0.008); 
            
            // --- NOUVEAU MONITORING ---
            const [cpuCost, setCpuCost] = useState(50); // Co√ªt CPU par compte en WAX
            const [networkStatus, setNetworkStatus] = useState("Calme");

            // Pack States
            const [packBuilder, setPackBuilder] = useState({ name: 'Pack Perso', price: 100, contents: [] });
            const [selectedFactoryToAdd, setSelectedFactoryToAdd] = useState(FACTORIES[0].id);

            // Account Sim States
            const [accountBuildings, setAccountBuildings] = useState([FACTORIES[0].id, FACTORIES[1].id, FACTORIES[2].id, FACTORIES[3].id]); 
            
            // Helpers
            const formatW = (v) => `${v.toLocaleString(undefined, {maximumFractionDigits:2})} W`;
            const formatUsd = (v) => `$${(v * waxPriceUsd).toFixed(2)}`;

            // --- CALCULS (CORE LOGIC v3.4) ---
            
            const factoryAnalysis = useMemo(() => {
                return FACTORIES.map(factory => {
                    const dailyProdWax = factory.output * 24 * marketPrices[`DOV${factory.type.charAt(0)}`]; 
                    const dailyCostWax = factory.costDoVX * 24 * marketPrices.DOVX;
                    const dailyNetWax = dailyProdWax - dailyCostWax;
                    
                    // --- AJOUT LOGIQUE CPU DU MONITORING ---
                    // Valorisation = (Profit sur 1 an) + (Economie de Staking CPU)
                    const roiDays = 365;
                    const savedAccounts = Math.max(0, factory.accountsNeeded - 1);
                    const cpuSavings = savedAccounts * cpuCost; // Impact du monitoring ici
                    const fairValueWax = (dailyNetWax * roiDays) + cpuSavings;

                    return { 
                        ...factory, 
                        dailyProdWax, 
                        dailyCostWax, 
                        dailyNetWax, 
                        fairValueWax,
                        cpuSavings // Pour affichage
                    };
                });
            }, [marketPrices, cpuCost]); // D√©pendance cpuCost ajout√©e

            const packStats = useMemo(() => {
                let dailyProd = 0, dailyCost = 0;
                packBuilder.contents.forEach(item => {
                    const f = factoryAnalysis.find(x => x.id === item.id);
                    if(f) {
                        dailyProd += f.dailyProdWax * item.qty;
                        dailyCost += f.dailyCostWax * item.qty;
                    }
                });
                const dailyNet = dailyProd - dailyCost;
                const roiDays = dailyNet > 0 ? (packBuilder.price / dailyNet) : 0;
                
                // INDICATEUR APR (v3.4 Requirement)
                const yearlyNet = dailyNet * 365;
                const apr = packBuilder.price > 0 ? (yearlyNet / packBuilder.price) * 100 : 0;

                return { dailyProd, dailyCost, dailyNet, roiDays, apr };
            }, [packBuilder, factoryAnalysis]);

            const accountStats = useMemo(() => {
                let prod = 0, maint = 0;
                accountBuildings.forEach(id => {
                    const f = factoryAnalysis.find(x => x.id === id);
                    if(f) { prod += f.dailyProdWax; maint += f.dailyCostWax; }
                });
                const net = prod - maint;
                return { 
                    prod, maint, net, 
                    monthly: net * 30, 
                    yearly: net * 365 
                };
            }, [accountBuildings, factoryAnalysis]);

            // --- ACTIONS ---
            const setNetworkPreset = (level) => {
                if (level === 'Low') { setCpuCost(50); setNetworkStatus("Calme (Standard)"); }
                if (level === 'Med') { setCpuCost(200); setNetworkStatus("Charg√© (Congestion)"); }
                if (level === 'High') { setCpuCost(600); setNetworkStatus("Satur√© (Crise)"); }
            };

            const addToPack = () => {
                const existing = packBuilder.contents.find(i => i.id === selectedFactoryToAdd);
                if (existing) {
                    setPackBuilder({ ...packBuilder, contents: packBuilder.contents.map(i => i.id === selectedFactoryToAdd ? {...i, qty: i.qty + 1} : i) });
                } else {
                    setPackBuilder({ ...packBuilder, contents: [...packBuilder.contents, { id: selectedFactoryToAdd, qty: 1 }] });
                }
            };
            const removeFromPack = (id) => setPackBuilder({ ...packBuilder, contents: packBuilder.contents.filter(i => i.id !== id) });

            // --- RENDER ---
            return (
                <div className="p-6 max-w-7xl mx-auto space-y-6">
                    {/* Header */}
                    <div className="flex justify-between items-center border-b border-slate-700 pb-4">
                        <h1 className="text-2xl font-bold text-blue-400">DoV COMMANDER v3.4 + Network</h1>
                        <div className="flex gap-4">
                            <div className="bg-slate-800 p-2 rounded text-xs">
                                <span className="text-slate-400">Prix WAX</span>
                                <input type="number" value={waxPriceUsd} onChange={e=>setWaxPriceUsd(parseFloat(e.target.value))} className="bg-transparent font-bold w-16 ml-2" step="0.001"/>
                            </div>
                        </div>
                    </div>

                    {/* Navigation */}
                    <div className="flex gap-2 overflow-x-auto pb-2">
                        <button onClick={() => setActiveTab('network')} className={`px-4 py-2 rounded font-bold text-sm flex items-center gap-2 ${activeTab === 'network' ? 'bg-purple-600 text-white' : 'bg-slate-800 text-slate-400'}`}><IconNetwork/> R√âSEAU / CPU</button>
                        <button onClick={() => setActiveTab('account_sim')} className={`px-4 py-2 rounded font-bold text-sm flex items-center gap-2 ${activeTab === 'account_sim' ? 'bg-orange-600 text-white' : 'bg-slate-800 text-slate-400'}`}><IconFactory/> COMPTE</button>
                        <button onClick={() => setActiveTab('packs')} className={`px-4 py-2 rounded font-bold text-sm flex items-center gap-2 ${activeTab === 'packs' ? 'bg-purple-600 text-white' : 'bg-slate-800 text-slate-400'}`}><IconPack/> PACKS</button>
                        <button onClick={() => setActiveTab('valuation')} className={`px-4 py-2 rounded font-bold text-sm flex items-center gap-2 ${activeTab === 'valuation' ? 'bg-cyan-600 text-white' : 'bg-slate-800 text-slate-400'}`}><IconValuation/> VALORISATION</button>
                    </div>

                    {/* === ONGLET R√âSEAU / MONITORING (NOUVEAU) === */}
                    {activeTab === 'network' && (
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 animate-fade-in">
                            <div className="bg-slate-800 border border-slate-700 rounded-lg p-4 shadow-xl">
                                <h3 className="font-bold text-white mb-4 flex items-center gap-2">1. Monitoring Temps R√©el</h3>
                                <div className="space-y-4">
                                    <p className="text-sm text-slate-400">Consultez ces outils officiels pour voir la charge CPU ("CPU Usage") :</p>
                                    <div className="flex gap-4">
                                        <a href="https://wax.antelope.tools/" target="_blank" className="flex-1 bg-slate-700 hover:bg-slate-600 text-white p-3 rounded text-center font-bold border border-slate-600">
                                            üìä Antelope Tools
                                        </a>
                                        <a href="https://waxblock.io/" target="_blank" className="flex-1 bg-slate-700 hover:bg-slate-600 text-white p-3 rounded text-center font-bold border border-slate-600">
                                            ‚õìÔ∏è Waxblock Explorer
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-slate-800 border border-slate-700 rounded-lg p-4 shadow-xl">
                                <h3 className="font-bold text-cyan-400 mb-4 flex items-center gap-2">2. Impact "Fair Value"</h3>
                                <p className="text-sm text-slate-400 mb-4">Ajustez le co√ªt de staking actuel. Cela mettra √† jour la valeur des usines F5 dans l'onglet Valorisation.</p>
                                
                                <div className="bg-slate-900 p-4 rounded border border-slate-700 mb-4">
                                    <div className="flex justify-between mb-2">
                                        <span className="text-slate-400 text-xs uppercase">√âtat du R√©seau</span>
                                        <span className={`font-bold ${cpuCost > 200 ? 'text-red-500' : cpuCost > 100 ? 'text-yellow-500' : 'text-green-500'}`}>{networkStatus}</span>
                                    </div>
                                    <input type="range" min="10" max="1000" step="10" value={cpuCost} onChange={e => { setCpuCost(parseInt(e.target.value)); setNetworkStatus("Personnalis√©"); }} className="w-full mb-2 accent-cyan-500"/>
                                    <div className="flex justify-between text-xs text-slate-500 font-mono">
                                        <span>10 W</span>
                                        <span className="text-white font-bold text-lg">{cpuCost} WAX / Compte</span>
                                        <span>1000 W</span>
                                    </div>
                                </div>

                                <div className="flex gap-2">
                                    <button onClick={() => setNetworkPreset('Low')} className="flex-1 py-1 rounded bg-green-900/30 text-green-400 border border-green-800 text-xs">üü¢ Calme (50W)</button>
                                    <button onClick={() => setNetworkPreset('Med')} className="flex-1 py-1 rounded bg-yellow-900/30 text-yellow-400 border border-yellow-800 text-xs">üü° Charg√© (200W)</button>
                                    <button onClick={() => setNetworkPreset('High')} className="flex-1 py-1 rounded bg-red-900/30 text-red-400 border border-red-800 text-xs">üî¥ Satur√© (600W)</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* === ONGLET COMPTE (v3.4 Base) === */}
                    {activeTab === 'account_sim' && (
                        <div className="space-y-6 animate-fade-in">
                            <div className="bg-slate-800 border border-slate-700 rounded-lg p-4 shadow-xl">
                                <h3 className="text-lg font-bold text-orange-400 mb-4 flex items-center gap-2"><FactoryIcon /> Configuration Production (4 Slots)</h3>
                                <div className="space-y-3">
                                    {accountBuildings.map((bId, idx) => (
                                        <div key={idx} className="flex gap-2 items-center">
                                            <span className="text-xs text-slate-500 w-6">#{idx+1}</span>
                                            <select 
                                                value={bId} 
                                                onChange={(e) => {
                                                    const newBuilds = [...accountBuildings];
                                                    newBuilds[idx] = e.target.value;
                                                    setAccountBuildings(newBuilds);
                                                }}
                                                className="flex-1 bg-slate-900 border border-slate-700 rounded p-2 text-sm focus:outline-none focus:border-orange-500"
                                            >
                                                {FACTORIES.map(f => (
                                                    <option key={f.id} value={f.id}>{f.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                    ))}
                                </div>
                                {/* INDICATEURS NET/BRUT v3.4 */}
                                <div className="mt-4 pt-4 border-t border-slate-700 grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <div className="text-slate-400 text-xs">Production Brute /j</div>
                                        <div className="text-emerald-400 font-mono font-bold">
                                            +{formatW(accountStats.prod)}
                                        </div>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-slate-400 text-xs">Co√ªt Maintenance /j</div>
                                        <div className="text-red-400 font-mono font-bold">
                                            -{formatW(accountStats.maint)}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-slate-800/80 border-t-4 border-t-emerald-500 rounded-lg p-4 shadow-xl">
                                <div className="text-center mb-4 text-emerald-400 font-bold tracking-widest text-sm uppercase">Bilan Consolid√© (Net)</div>
                                <div className="grid grid-cols-3 gap-4 text-center">
                                    <div className="p-2 bg-slate-900/50 rounded">
                                        <div className="text-xs text-slate-400 mb-1">PAR JOUR (NET)</div>
                                        <div className="text-xl font-bold text-white">{formatW(accountStats.net)}</div>
                                        <div className="text-xs text-emerald-400">{formatUsd(accountStats.net)}</div>
                                    </div>
                                    <div className="p-2 bg-slate-900/50 rounded border border-slate-700">
                                        <div className="text-xs text-purple-300 mb-1">PAR MOIS (NET)</div>
                                        <div className="text-xl font-bold text-purple-100">{formatW(accountStats.monthly)}</div>
                                    </div>
                                    <div className="p-2 bg-slate-900/50 rounded">
                                        <div className="text-xs text-slate-400 mb-1">PAR AN (NET)</div>
                                        <div className="text-xl font-bold text-white">{formatW(accountStats.yearly)}</div>
                                        {/* INDICATEUR APR v3.4 */}
                                        <div className="text-[10px] text-slate-500 mt-1">
                                            APR (Est.) : {((accountStats.yearly / (accountStats.prod * 365)) * 100).toFixed(0)}%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* === ONGLET PACKS (v3.4 avec d√©tail Net/Brut) === */}
                    {activeTab === 'packs' && (
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 animate-fade-in">
                            <div className="bg-slate-800 border border-slate-700 rounded-lg p-4 shadow-xl">
                                <h3 className="font-bold text-purple-400 mb-4">Configuration</h3>
                                <div className="mb-4">
                                    <label className="text-xs text-slate-400">Prix Pack ($)</label>
                                    <input type="number" value={packBuilder.price} onChange={e => setPackBuilder({...packBuilder, price: parseFloat(e.target.value)})} className="w-full bg-slate-900 border border-purple-500 rounded p-2 text-white font-bold"/>
                                </div>
                                <div className="flex gap-2 mb-6">
                                    <select className="flex-1 bg-slate-900 border border-slate-600 rounded p-2 text-sm" value={selectedFactoryToAdd} onChange={e => setSelectedFactoryToAdd(e.target.value)}>
                                        {FACTORIES.map(f => <option key={f.id} value={f.id}>{f.name}</option>)}
                                    </select>
                                    <button onClick={addToPack} className="bg-purple-600 text-white p-2 rounded"><IconPlus/></button>
                                </div>
                                <h4 className="text-xs uppercase text-slate-500 mb-2">Contenu (D√©tail Net)</h4>
                                <div className="space-y-2 max-h-[300px] overflow-y-auto">
                                    {packBuilder.contents.map((item, i) => {
                                        const f = factoryAnalysis.find(x => x.id === item.id);
                                        return (
                                            <div key={i} className="bg-slate-900 p-2 rounded border border-slate-700 flex flex-col gap-1">
                                                <div className="flex justify-between">
                                                    <span className="font-bold text-sm text-white">{f.name} x{item.qty}</span>
                                                    <button onClick={() => removeFromPack(item.id)} className="text-red-500 text-xs"><IconTrash/></button>
                                                </div>
                                                <div className="flex justify-between text-[10px]">
                                                    <span className="text-emerald-400">Brut: {formatW(f.dailyProdWax * item.qty)}</span>
                                                    <span className="text-red-400">Maint: -{formatW(f.dailyCostWax * item.qty)}</span>
                                                    <span className="text-white font-bold">Net: {formatW(f.dailyNetWax * item.qty)}</span>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                            
                            <div className="bg-slate-800 border-t-4 border-t-purple-500 rounded-lg p-4 shadow-xl">
                                <h3 className="font-bold text-white mb-6">Analyse Financi√®re</h3>
                                <div className="grid grid-cols-2 gap-4 text-xs mb-6">
                                    <div><span className="text-slate-500">Prod Brute</span><div className="text-emerald-400 font-bold">{formatW(packStats.dailyProd)}</div></div>
                                    <div className="text-right"><span className="text-slate-500">Maintenance</span><div className="text-red-400 font-bold">-{formatW(packStats.dailyCost)}</div></div>
                                </div>
                                <div className="bg-slate-900 p-4 rounded border border-slate-700 text-center mb-6">
                                    <div className="text-slate-400 text-xs uppercase mb-1">Profit Net Quotidien</div>
                                    <div className="text-2xl font-bold text-white">{formatW(packStats.dailyNet)}</div>
                                </div>
                                <div className="text-center">
                                    <div className="text-xs text-slate-500 uppercase">Retour sur Investissement</div>
                                    {packStats.dailyNet > 0 ? (
                                        <div>
                                            <div className="text-4xl font-bold text-white">{Math.ceil(packStats.roiDays)} <span className="text-sm font-normal text-slate-400">Jours</span></div>
                                            <div className="inline-block bg-emerald-900/50 text-emerald-400 px-2 py-1 rounded text-xs mt-2 border border-emerald-700">APR: {packStats.apr.toFixed(2)}%</div>
                                        </div>
                                    ) : <div className="text-red-400 font-bold">NON RENTABLE</div>}
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* === ONGLET VALORISATION (Impact Monitoring) === */}
                    {activeTab === 'valuation' && (
                        <div className="space-y-6 animate-fade-in">
                            <div className="bg-slate-800 border border-slate-700 rounded-lg p-4 shadow-xl">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="font-bold text-cyan-400">Valorisation des Actifs (Fair Value)</h3>
                                    <div className="text-xs text-slate-400 text-right">
                                        <div>Inclut Profit Net sur 365j</div>
                                        <div className="text-cyan-400">+ √âconomie Staking ({cpuCost} WAX/cpte)</div>
                                    </div>
                                </div>
                                <table className="w-full text-left text-sm">
                                    <thead className="text-slate-500 text-xs uppercase border-b border-slate-700"><tr><th className="p-2">Actif</th><th className="p-2 text-right">Prod Net (1an)</th><th className="p-2 text-right">Gain CPU</th><th className="p-2 text-right">Valeur Juste</th></tr></thead>
                                    <tbody>
                                        {factoryAnalysis.map(f => (
                                            <tr key={f.id} className="border-b border-slate-700/50 hover:bg-slate-800">
                                                <td className="p-2 font-bold text-white flex items-center gap-2">{f.name}{f.level===5 && <span className="bg-indigo-500 text-[10px] px-1 rounded">üíé</span>}</td>
                                                <td className="p-2 text-right text-slate-300">{formatW(f.dailyNetWax * 365)}</td>
                                                <td className="p-2 text-right text-indigo-300 font-bold">+{formatW(f.cpuSavings)}</td>
                                                <td className="p-2 text-right font-bold text-cyan-400">{formatW(f.fairValueWax)}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    )}

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DoVManager />);
    </script>
</body>
</html>
