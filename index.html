<div id="wax-monitor-widget">
  <div class="wm-header">
    <span class="wm-status-dot"></span> WAX MAINNET <span class="wm-live">LIVE</span>
  </div>
  
  <div class="wm-grid">
    <div class="wm-stat">
      <span class="wm-label">HEAD BLOCK</span>
      <span id="wm-head-block" class="wm-value">Chargement...</span>
    </div>
    
    <div class="wm-stat">
      <span class="wm-label">LIB (Irreversible)</span>
      <span id="wm-lib-block" class="wm-value">---</span>
    </div>
    
    <div class="wm-stat">
      <span class="wm-label">TPS (Estimé)</span>
      <span id="wm-tps" class="wm-value">---</span>
    </div>
    
    <div class="wm-stat">
      <span class="wm-label">PRODUCER</span>
      <span id="wm-producer" class="wm-value">---</span>
    </div>
  </div>
  
  <div class="wm-footer">
    Dernière MAJ: <span id="wm-last-update">--:--:--</span>
  </div>
</div>

<style>
  /* Styles Futuristes / Dark Mode */
  #wax-monitor-widget {
    background: #0f0f13; /* Fond sombre */
    border: 1px solid #333;
    border-left: 4px solid #f5a623; /* Couleur WAX Orange */
    color: #e0e0e0;
    font-family: 'Courier New', Courier, monospace; /* Police style terminal */
    padding: 15px;
    width: 300px; /* Largeur ajustable */
    border-radius: 4px;
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
    margin: 20px auto;
  }

  .wm-header {
    display: flex;
    align-items: center;
    font-weight: bold;
    color: #f5a623;
    margin-bottom: 15px;
    border-bottom: 1px solid #333;
    padding-bottom: 5px;
    font-size: 14px;
  }

  .wm-status-dot {
    height: 10px;
    width: 10px;
    background-color: #00ff00;
    border-radius: 50%;
    display: inline-block;
    margin-right: 8px;
    box-shadow: 0 0 5px #00ff00;
    animation: pulse 1.5s infinite;
  }

  .wm-live {
    margin-left: auto;
    font-size: 10px;
    background: #f5a623;
    color: #000;
    padding: 2px 5px;
    border-radius: 2px;
  }

  .wm-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }

  .wm-stat {
    display: flex;
    flex-direction: column;
  }

  .wm-label {
    font-size: 10px;
    color: #888;
    text-transform: uppercase;
  }

  .wm-value {
    font-size: 14px;
    font-weight: bold;
    color: #fff;
    text-shadow: 0 0 2px rgba(255,255,255,0.3);
  }

  .wm-footer {
    margin-top: 15px;
    font-size: 10px;
    color: #666;
    text-align: right;
  }

  @keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
  }
</style>

<script>
  (function() {
    // Endpoint Public RPC WAX (Greymass est très fiable)
    const RPC_ENDPOINT = 'https://wax.greymass.com/v1/chain/get_info';
    
    // Elements du DOM
    const elHeadBlock = document.getElementById('wm-head-block');
    const elLibBlock = document.getElementById('wm-lib-block');
    const elProducer = document.getElementById('wm-producer');
    const elLastUpdate = document.getElementById('wm-last-update');
    // Note: Le TPS réel nécessite des calculs complexes sur l'historique, 
    // ici on affichera une valeur placeholder ou calculée simplement si possible.
    // Pour simplifier ce script sans backend, on utilise le CPU limit comme indicateur d'activité ou juste "OK".
    const elTps = document.getElementById('wm-tps');

    async function updateStats() {
      try {
        const response = await fetch(RPC_ENDPOINT);
        if (!response.ok) throw new Error('Network response was not ok');
        const data = await response.json();

        // Formatage des nombres avec séparateurs de milliers
        elHeadBlock.innerText = data.head_block_num.toLocaleString();
        elLibBlock.innerText = data.last_irreversible_block_num.toLocaleString();
        elProducer.innerText = data.head_block_producer;
        
        // Mise à jour de l'heure
        const now = new Date();
        elLastUpdate.innerText = now.toLocaleTimeString();

        // Indication visuelle de clignotement pour montrer l'activité
        elHeadBlock.style.color = '#f5a623';
        setTimeout(() => { elHeadBlock.style.color = '#fff'; }, 300);

        // Placeholder pour l'état du réseau (basé sur la réponse)
        elTps.innerText = "ACTIF"; 
        elTps.style.color = "#00ff00";

      } catch (error) {
        console.error('Erreur WAX Monitor:', error);
        elHeadBlock.innerText = "Erreur...";
      }
    }

    // Mise à jour toutes les 1000ms (1 seconde) car les blocs WAX sont produits toutes les 0.5s
    setInterval(updateStats, 1000);
    
    // Premier appel immédiat
    updateStats();
  })();
</script>
